<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css?date=2023072231335">
  <script src="js/main.js?date=2023072231335"></script>
  <script src="js/addform.js?date=2023072231335"></script>
  <script src="js/calculate.js?date=2023072231335"></script>
  <script src="js/savedata.js?date=2023072231335"></script>
  <title>FGO Damage Roadmap</title>
</head>
<body>
  <header>
    <a href="./index.html" id="title">FGO Damage Roadmap</a>
    <label class="menu-button">≡<input type="checkbox" id="menucheck" onchange="openMenu(this)"></label>
    <div class="menu">
      <div id="menu-close-button"><label class="menu-button" for="menucheck">×</label></div>
      <div class="menu__item"><a href="./index.html">ダメージ計算</a></div>
      <div class="menu__item"><a href="./rndlist.html">乱数パターン計算</a></div>
      <div class="menu__item"><a href="https://twitter.com/yukimisnowy" target="_blank" rel="noopener noreferrer">管理者Twitter</a></div>
    </div>
  </header>

  <main>
    <h2>ダメージ計算</h2>
    <div class="container">
      <form id="fgocalc-form">
        <div class="input-field">
          <form action="">
            <div class="turn-wrapper">
              <h3>基本情報</h3>
              <div class="servant-info">
                <input type="text" class="servant-name" id="servant-name" size="10" placeholder="サーヴァント名">
                <select id="servant-class">
                  <option value="saber">剣</option>
                  <option value="archer">弓</option>
                  <option value="lancer">槍</option>
                  <option value="rider">騎</option>
                  <option value="caster">術</option>
                  <option value="assassin">殺</option>
                  <option value="berserker">狂</option>
                  <option value="ruler">裁</option>
                  <option value="avenger">讐</option>
                  <option value="alterego">分</option>
                  <option value="mooncancer">月</option>
                  <option value="pretender">詐</option>
                  <option value="foreigner">降</option>
                  <option value="shielder">盾</option>
                  <option value="beast">獣</option>
                </select>
                <select id="servant-attr">
                  <option value="sky">天</option>
                  <option value="earth">地</option>
                  <option value="human">人</option>
                  <option value="star">星</option>
                  <option value="beast">獣</option>
                </select>
                <br>
                <label>ATK:<input type="number" class="numberfield" id="servant-atk" min="0" max="30000"><br></label>
                <lebel>礼装ATK:<input type="number" class="numberfield" id="craft-essence-atk" min="0" max="3000"></lebel>
                <br>
                <label>宝具色:<select id="np-color" id="np-color" onchange="colorChangeCheck()">
                    <option value="b">B</option>
                    <option value="a">A</option>
                    <option value="q">Q</option>
                </select></label><br>
                <label>宝具倍率:<input type="number" class="numberfield" id="np-mag" min="0" max="5000">%</label>
                <br>
                <label>足跡 B:<input type="number" class="numberfield" id="b-footprint" min="0" max="500"></label>
                <label>A:<input type="number" class="numberfield" id="a-footprint" min="0" max="500"></label>
                <label>Q:<input type="number" class="numberfield" id="q-footprint" min="0" max="500"></label>
                <br>
                <label><input id="np-calc-check" type="checkbox" onchange="npCalcCheck(this)">NP・スター計算</label>
                <div class="np-and-star-info">
                  <label>N/A:<input type="number" class="numberfield" id="np-rate" min="0" max="10" step="0.01">%</label><br>
                  <label>星発生率:<input type="number" class="numberfield" id="star-rate" min="0" max="20" step="0.1">%</label>
                  <br>
                  <label>hit数 宝具:<input type="number" class="hitcount numberfield" id="n-hit-count" min="1" max="20"></label>
                  <label>B:<input type="number" class="hitcount numberfield" id="b-hit-count" min="1" max="20"></label>
                  <label>A:<input type="number" class="hitcount numberfield" id="a-hit-count" min="1" max="20"></label>
                  <label>Q:<input type="number" class="hitcount numberfield" id="q-hit-count" min="1" max="20"></label>
                  <label>EX:<input type="number" class="hitcount numberfield" id="ex-hit-count" min="1" max="20"></label>
                  </label>
                </div>
              </div>
            </div>

            <div class="turn-wrapper">
              <h3>パッシブ/開始時効果</h3>
              <div id="passive-skill">
                  <input type="button" value="追加" onclick="addForm(this,0)">
              </div>
            </div>

            <div id="turns">
            </div>

            <div class="button-wrapper">
              <input type="button" value="ターン追加" onclick="addTurn()">
              <input class="turn-delete-button" type="button" value="ターン削除" onclick="deleteTurn()">
              <input type="button" value="計算" onclick="calculate()">
              <label id="colorcheck">カード選択に色をつける<input type="checkbox" onchange="colorChangeCheck()"></label>
            </div>
          </form>
        </div>
      </form>

      <div class="resultform">
        <table class="result" id="result-form">
          <div id="midashi">
            <tr>
              <th class="table1">ターン</th>
              <th>1st</th>
              <th>2nd</th>
              <th>3rd</th>
              <th>EX</th>
              <th>total</th>
              <th class="goal-damage">目標ダメ</th>
              <th>撃破率</th>
            </tr>
          </div>
          <tr class="r1 result-content">
            <td class="turn-result-name" rowspan="4">1T</td>
            <td class="cardname"><output type="text" name="result"></output></td>
            <td class="cardname"><output type="text" name="result"></output></td>
            <td class="cardname"><output type="text" name="result"></output></td>
            <td><output type="number" class="numberfield">-</output></td>
            <td><output type="number" class="numberfield">-</output></td>
            <td class="goal-damage"><output type="number" class="numberfield">-</output></td>
            <td><output type="number" class="numberfield">-</output></td>
          </tr>
          <tr class="r2 result-content">
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td class="goal-damage" rowspan="3"><output type="number" class="numberfield" name="result"></output></td>
            <td rowspan="3"><output type="number" class="numberfield" name="result"></output>%</td>
          </tr>
          <tr class="r3 result-content">
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
          </tr>
          <tr class="r4 result-content">
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
            <td><output type="number" class="numberfield" name="result"></output></td>
          </tr>
        </table>
      </div>
      
      <div class="button-wrapper">
        <input type="button" value="エクスポート" onclick="exportData()">
        <input id="upload-file" type="file" accept=".csv">
        <input type="button" value="適用" onclick="inportData()">
      </div>
      <div class="notice">
        <details>
          <summary>
            お知らせ・更新履歴
          </summary>
            <li>【重要】NP・スター計算実装の前後でクリティカル判定の保存に齟齬が生じています。お手数おかけしますが修正、再保存をお願いします。(2023/7/22)</li>
            <li>【更新】NP・スター計算機能を追加しました。それに伴い、クリティカルとダメージ0の判定欄を分割しました。(2023/7/22)</li>
            <li>【修正】20日の更新以降バフが反映できず、計算が成り立たない状態になっておりました。大変ご迷惑をおかけしました。(2023/7/21)</li>
            <li>【更新】入力情報のローカル保存機能を追加しました。(2023/7/20)</li>
            <li>【更新】バフ項目の並べ替え、カード色分け機能を追加しました。(2023/7/20)</li>
            <li>【修正】不具合を修正しました。(2023/7/19)</li>
            <li>【重要】計算機を公開しました。(2023/7/19)</li>
        </details>
      </div>
    </div>

    <template id='buff-form-template'>
      <div class="buff-form">
        <input type="text" class="skill-name" size="8" placeholder="スキル/バフ名">
        <select class="skill-type" onchange="inputChange(this)">
          <option value="atk_buff">攻撃バフ</option>
          <option value="b_buff">Bバフ</option>
          <option value="b_power_buff">Bバフ(スコア)</option>
          <option value="a_buff">Aバフ</option>
          <option value="a_power_buff">Aバフ(スコア)</option>
          <option value="q_buff">Qバフ</option>
          <option value="q_power_buff">Qバフ(スコア)</option>
          <option value="ex_buff">EXバフ</option>
          <option value="np_buff">宝具バフ</option>
          <option value="cr_buff">クリバフ</option>
          <option value="b_cr_buff">Bクリバフ</option>
          <option value="a_cr_buff">Aクリバフ</option>
          <option value="q_cr_buff">Qクリバフ</option>
          <option value="sp_buff">特攻バフ</option>
          <option value="sp_np">特攻宝具</option>
          <option value="np_mag_up">宝具倍率増加</option>
          <option value="sp_def">特殊耐性</option>
          <option value="damage_plus">ダメージ＋</option>
          <option value="npget_buff">NP獲得バフ</option>
          <option value="starget_buff">星発生バフ</option>
        </select>
        <input type="number" class="numberfield amount" min="-10000" max="10000" placeholder="効果量">
        <select class="turn">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="0">-</option>
        </select>T
        <select class="time">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="0" selected>-</option>
        </select>回
        <input type="button" value="✖" onclick="deleteForm(this)">
        <input type="button" value="▲" onclick="sortForm(this)">
      </div>
    </template>

    <template id="turn-template">
      <div id="turn0" class="turn-wrapper turn-form">
        <h3>0T目</h3>
        <div class="enemy-info">
          <label>クラス相性:
            <select id="turn0-class">
              <option value="0.5">0.5</option>
              <option value="1.0">1.0</option>
              <option value="1.2">1.2</option>
              <option value="1.5">1.5</option>
              <option value="2.0" selected>2.0</option>
            </select>
          </label>
          <label>属性相性:
            <select id="turn0-attr">
              <option value="0.9">0.9</option>
              <option value="1.0" selected>1.0</option>
              <option value="1.1">1.1</option>
            </select>
          </label>
          <input type="number" id="turn0-enemy-hp" min="0" max="100000000" placeholder="目標ダメージ">
          <label class="np-and-star-info">DTDR(NP敵補正):
          <input type="number" class="numberfield np-and-star-info" id="turn0-dtdr" min="0" max="1000" placeholder="DTDR" value="100">%</label>
          <label class="np-and-star-info">DSR(スター敵補正):
          <input type="number" class="numberfield np-and-star-info" id="turn0-dsr" min="-100" max="100" placeholder="DSR" value="0">%</label>
        </div>
        <div class="turn-skill" id="turn0-skill">
          <input type="button" value="スキル追加">
        </div>
        <div class="card-select-wrapper">
          <div class="card-select" id="turn0-card1">
            <label>1st
            <select id="turn0-card1-color" class="card-color-select" onchange="changeColor(this)">
              <option value="n" selected>N</option>
              <option value="b">B</option>
              <option value="a">A</option>
              <option value="q">Q</option>
            </select></label>
            <label>クリティカル
            <select id="turn0-card1-cri">
              <option value="2">有</option>
              <option value="1">無</option>
            </select></label>
            <select id="turn0-card1-bool">
              <option value="0">default</option>
              <option value="1">0(回数消費有)</option>
              <option value="2">0(回数消費無)</option>
            </select>
            <input type="number" class="numberfield np-and-star-info" id="turn0-card1-ovk" min="0" max="100" placeholder="Overkill">
            <div class="card-skill" id="turn0-card1-skill">
              <input type="button" value="追加">
            </div>
          </div>

          <div class="card-select" id="turn0-card2">
            <label>2nd
            <select id="turn0-card2-color" class="card-color-select" onchange="changeColor(this)">
              <option value="n">N</option>
              <option value="b" selected>B</option>
              <option value="a">A</option>
              <option value="q">Q</option>
            </select></label>
            <label>クリティカル
            <select id="turn0-card2-cri">
              <option value="2">有</option>
              <option value="1">無</option>
            </select></label>
            <select id="turn0-card2-bool">
              <option value="0">default</option>
              <option value="1">0(回数消費有)</option>
              <option value="2">0(回数消費無)</option>
            </select>
            <input type="number" class="numberfield np-and-star-info" id="turn0-card2-ovk" min="0" max="100" placeholder="Overkill">
            <div id="turn0-card2-skill">
              <input type="button" value="追加">
            </div>
          </div>

          <div class="card-select" id="turn0-card3">
            <label>3rd
            <select id="turn0-card3-color" class="card-color-select" onchange="changeColor(this)">
              <option value="n">N</option>
              <option value="b" selected>B</option>
              <option value="a">A</option>
              <option value="q">Q</option>
            </select></label>
            <label>クリティカル
            <select id="turn0-card3-cri">
              <option value="2">有</option>
              <option value="1">無</option>
            </select></label>
            <select id="turn0-card3-bool">
              <option value="0">default</option>
              <option value="1">0(回数消費有)</option>
              <option value="2">0(回数消費無)</option>
            </select>
            <input type="number" class="numberfield np-and-star-info" id="turn0-card3-ovk" min="0" max="100" placeholder="Overkill">
            <div id="turn0-card3-skill">
              <input type="button" value="追加">
            </div>
          </div>

          <div class="card-select" id="turn0-card4">
            <label>4th
            <select id="turn0-card4-color" class="card-color-select">
              <option value="ex">EX</option>
              <option value="-1">-</option>
            </select></label>
            <select id="turn0-card4-bool">
              <option value="0">default</option>
              <option value="1">0(回数消費有)</option>
              <option value="2">0(回数消費無)</option>
            </select>
            <input type="number" class="numberfield np-and-star-info" id="turn0-card4-ovk" min="0" max="100" placeholder="Overkill"></label>
            <div id="turn0-card4-skill">
              <input type="button" value="追加">
            </div>
          </div>
        </div>
        <!-- <label>メモ
        <textarea name="turn1-note" class="note"></textarea>
        </label> -->
      </div>
    </template>

    <template id="result-template1">
      <tr class="r1 result-content">
        <td class="turn-result-name" rowspan="4">1T</td>
        <td class="cardname"><output type="text" name="result"></output></td>
        <td class="cardname"><output type="text" name="result"></output></td>
        <td class="cardname"><output type="text" name="result"></output></td>
        <td><output type="number" class="numberfield">-</output></td>
        <td><output type="number" class="numberfield">-</output></td>
        <td class="goal-damage"><output type="number" class="numberfield">-</output></td>
        <td><output type="number" class="numberfield">-</output></td>
      </tr>
      <tr class="r2 result-content">
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td class="goal-damage" rowspan="3"><output type="number" class="numberfield" name="result"></output></td>
        <td rowspan="3"><output type="number" class="numberfield" name="result"></output>%</td>
      </tr>
      <tr class="r3 result-content">
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
      </tr>
      <tr class="r4 result-content">
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
        <td><output type="number" class="numberfield" name="result"></output></td>
      </tr>
    </template>

    <template id="result-template2">
      <tr class="r5 result-content">
        <td><output type="number" class="numberfield">NP</output></td>
        <td><output type="number" class="numberfield" name="npresult"></output></td>
        <td><output type="number" class="numberfield" name="npresult"></output></td>
        <td><output type="number" class="numberfield" name="npresult"></output></td>
        <td><output type="number" class="numberfield" name="npresult"></output></td>
        <td><output type="number" class="numberfield" name="npresult"></output></td>
        <td class="goal-damage"><output type="number" class="numberfield"></output></td>
        <td><output type="number" class="numberfield"></output></td>
      </tr>
      <tr class="r6 result-content">
        <td><output type="number" class="numberfield">星</output></td>
        <td><output type="number" class="numberfield" name="starresult"></output></td>
        <td><output type="number" class="numberfield" name="starresult"></output></td>
        <td><output type="number" class="numberfield" name="starresult"></output></td>
        <td><output type="number" class="numberfield" name="starresult"></output></td>
        <td><output type="number" class="numberfield" name="starresult"></output></td>
        <td class="goal-damage"><output type="number" class="numberfield"></output></td>
        <td><output type="number" class="numberfield"></output></td>
      </tr>
    </template>

  </main>

  <footer>
    <a href="https://twitter.com/yukimisnowy" target="_blank" rel="noopener noreferrer" class="footer-item">管理者Twitter</a>
  </footer>
</body>
</html>